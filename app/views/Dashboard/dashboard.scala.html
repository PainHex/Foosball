@(users: Seq[models.User])(implicit session: play.mvc.Scope.Session)

@main{
  <title>Foosball - Dashboard</title>

  <script type="text/javascript">
    $(document).ready(function() {
      var players = [@users.map("'" + _.name + "'").mkString(",")];

      $(".inputField").autocomplete({
        source: players
      });

      $(".linkButton").click(function(event) {
        var $this = $(this);
        if ($this.hasClass("deselected")) {
          $(".linkButton").addClass("deselected");
          $(this).removeClass("deselected");

          var playerName = $this.siblings("input")[0].value;

          var $resultSubmit = $("#resultSubmit");
          $resultSubmit.removeClass("winner");
          $resultSubmit.removeClass("loser");
          $resultSubmit.prop("disabled", false);

          var buttonResult = $this.attr("result");
          if (buttonResult == "win") {
            $resultSubmit.addClass("winner");
            $resultSubmit.html("Record a win for " + playerName);
          } else {
            $resultSubmit.addClass("loser");
            $resultSubmit.html("Record a loss for " + playerName);
          }
        }
      });

      $(".playerName").keyup(function(event) {
        var $this = $(this);

        var siblingResults = $this.siblings(".linkButton").not(".deselected");
        if (siblingResults.length) {
          var $selectedResult = $(siblingResults[0]);
          $selectedResult.addClass("deselected");

          var $resultSubmit = $("#resultSubmit");
          $resultSubmit.removeClass("winner");
          $resultSubmit.removeClass("loser");
          $resultSubmit.prop("disabled", true);
          $resultSubmit.html("Select a result");
        }
      });
    });
  </script>
}{
  <div id="quickResults" class="widget small">
    <h2>Quick Results</h2>
    <fieldset class="singleColumn">
      @views.tags.html.playerResult("player1", 1)
      @views.tags.html.playerResult("player2", 2)
      @views.tags.html.playerResult("player3", 3)
      @views.tags.html.playerResult("player4", 4)
      <button id="resultSubmit" disabled="true">Select a result</button>
    </fieldset>
  </div>
}